# OpenShift-specific values for fraud-detection chart
# This file overrides values.yaml for OpenShift deployments

# Global settings
global:
  openshift: true

# OpenShift-specific features
openshift:
  enabled: true
  routes:
    enabled: true
    tls:
      termination: edge
      insecureEdgeTerminationPolicy: Redirect

# RBAC configuration
rbac:
  create: true

# ServiceAccount configuration
serviceAccount:
  create: true
  name: "demo-setup"

fullnameOverride: "lakefs"

# MinIO configuration (subchart) - OpenShift overrides
minio:
  enabled: true
  
  image:
    repository: quay.io/minio/minio
    tag: latest
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 9090
    apiPort: 9000
  
  volumeClaimTemplates:
    - metadata:
        name: minio-data
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 10Gi
  
  volumeMounts:
    - mountPath: /data
      name: minio-data
  
  resources:
    limits:
      cpu: "2"
      memory: 2Gi
    requests:
      cpu: 200m
      memory: 1Gi
  
  secret:
    name: pipeline-artifacts
    secret_key: something
    secret_access_key: simple
    endpoint: https://lakefs-fraud-detection.apps.ai-dev02.kni.syseng.devcluster.openshift.com
    defaultBucket: pipeline-artifacts
    # Override for subchart
    user: minio_user
    password: minio_password
  
  openshift:
    enabled: true
    routes:
      enabled: true
      tls:
        termination: edge
        insecureEdgeTerminationPolicy: Redirect
  
  # Bucket creation configuration
  buckets:
    create: true
    names:
      - pipeline-artifacts
      - my-storage
      - quickstart
  
  # ServiceAccount for jobs (needed for bucket creation)
  serviceAccount:
    create: false  # We'll use the main chart's ServiceAccount
    name: demo-setup
  
  rbac:
    create: true

# lakeFS configuration
lakefs:
  replicaCount: 1

  secret:
    name: ""  # Defaults to minio fullname
    secret_key:  something
    secret_access_key: simple
    endpoint: http://lakefs

    repo_name: my-storage
    default_region: us-east-1
    notebook_access_key_id: something
    notebook_secret_access_key: simple
  
  image:
    repository: treeverse/lakefs
    tag: "1.73.0"
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 8000
  
  resources:
    limits:
      cpu: "2"
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi
  
  podAnnotations: {}
  
  config:
    logging:
      format: json
      level: WARN
      output: "-"
    
    database:
      type: local
      # For external PostgreSQL:
      # type: postgres
      # postgres:
      #   connectionString: "postgres://user:pass@host:5432/lakefs"
    
    auth:
      encrypt:
        # Generate a random secret_key with: openssl rand -hex 32
        secretKey: "10a718b3f285d89c36e9864494cdd1507f3bc85b342df24736ea81f9a1134bcc"
    
    blockstore:
      type: s3
      s3:
        endpoint: http://minio:9000
        forcePathStyle: true
        discoverBucketRegion: false
        region: ""
  
  # lakeFS admin credentials for initial setup and API access
  adminCredentials:
    username: admin
    accessKeyId: something
    secretAccessKey: simple

# Repository creation configuration
repositories:
  create: true
  repos:
    - name: quickstart
      storageNamespace: s3://quickstart/
      defaultBranch: main
      sampleData: true
    - name: my-storage
      storageNamespace: s3://my-storage/
      defaultBranch: main
      sampleData: false

# Notebook configuration - OpenShift overrides
notebook:
  enabled: true  # Enable notebook for OpenShift AI
  
  # Username for the notebook
  username: "admin"
  
  # Notebook image configuration (Red Hat UBI Python - always available)
  # image-registry.openshift-image-registry.svc:5000/redhat-ods-applications/tensorflow:2025.2
  image:
    repository: image-registry.openshift-image-registry.svc:5000/redhat-ods-applications/tensorflow
    tag: "2025.2"
    pullPolicy: IfNotPresent
    name: "Python 3.12"  # Display name for the image
  
  # Resource configuration
  resources:
    size: "Small"  # Display name for size selection
    limits:
      cpu: "2"
      memory: "8Gi"
    requests:
      cpu: "1"
      memory: "4Gi"
  
  # Storage configuration
  storage:
    size: 20Gi
    storageClassName: ""  # Use default storage class if not specified
  
  # Shared memory for large model training
  shm:
    enabled: true
    size: 2Gi
  
  # lakeFS connection information
  lakefs:
    url: "http://lakefs"
  
  # MinIO connection information  
  minio:
    endpoint: "http://minio:9000"
    defaultBucket: "my-storage"  # Default bucket for data connections
  
  # OpenShift AI specific settings
  openshiftAI:
    dataConnections:
      enabled: true  # Create OpenShift AI data connections for MinIO and lakeFS
  
  # Git sync to automatically clone notebooks
  gitSync:
    enabled: true  # Automatically clone notebooks from repository
    repo: "https://github.com/rh-ai-quickstart/Fraud-Detection-data-versioning-with-lakeFS.git"
    branch: "rj_model_serving"
    image: "alpine/git:latest"

# PostgreSQL configuration for Model Registry
postgres:
  enabled: true
  name: postgres
  # Note: This is the namespace for the model registry. It is not the same as the namespace for the fraud detection project.
  # namespace: rhoai-model-registries  # Target namespace for PostgreSQL deployment
  namespace: fraud-detection
  
  # Image configuration
  image:
    repository: docker.io/postgres
    tag: "16-alpine"
    pullPolicy: IfNotPresent
  
  # ImageStream configuration (OpenShift only)
  imageName: postgres
  imageTag: "16-alpine"
  
  # Database credentials
  user: postgres_user
  password: postgres_password
  database: model_registry
  
  # Service configuration
  port: 5432
  
  # Optional SSL mode for connections (disable, allow, prefer, require, verify-ca, verify-full)
  # sslMode: prefer
  
  # Persistence configuration
  persistence:
    enabled: true
    size: 1Gi
    accessMode: ReadWriteOnce
    storageClassName: ""  # Use default storage class
  
  # Resource limits
  resources:
    limits:
      cpu: "1"
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi

# Model Registry configuration
modelRegistry:
  enabled: true  # Set to true to create Model Registry connection resources
  createService: true  # Set to true to deploy the actual ModelRegistry CR (requires model-registry-operator)
  name: lakefs-model-registry
  # namespace: rhoai-model-registries  # Should match mysql.namespace or adjust accordingly
  namespace: rhoai-model-registries
  
  # Service ports
  grpcPort: 9090
  restPort: 8080